<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Bulding and Testing a C++ Project with Bazel | David William Silva </title> <meta name="author" content="David W. Silva"> <meta name="description" content="Bulding and testing a C++ project with Bazel"> <meta name="keywords" content="david computer science software engineering phd"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9D%92%9F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://www.davidwsilva.com//blog/2024/building-with-bazel/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> David William Silva </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/computer_science/">Computer Science </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus </a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item " href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/projects/">projects</a> <div class="dropdown-divider"></div> <a class="dropdown-item " href="/blog/">blog</a> </div> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Bulding and Testing a C++ Project with Bazel</h1> <p class="post-meta"> Created in September 11, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/bazel"> <i class="fa-solid fa-hashtag fa-sm"></i> bazel</a>   <a href="/blog/tag/build"> <i class="fa-solid fa-hashtag fa-sm"></i> build</a>   <a href="/blog/tag/tool"> <i class="fa-solid fa-hashtag fa-sm"></i> tool</a>   ·   <a href="/blog/category/programming"> <i class="fa-solid fa-tag fa-sm"></i> programming</a>   <a href="/blog/category/build"> <i class="fa-solid fa-tag fa-sm"></i> build</a>   <a href="/blog/category/test"> <i class="fa-solid fa-tag fa-sm"></i> test</a>   <a href="/blog/category/bazel"> <i class="fa-solid fa-tag fa-sm"></i> bazel</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <p>Bazel is an opensource build and test tool. It was formelly named Blaze when used internally at Google. It is similar to <a href="https://www.gnu.org/software/make/" rel="external nofollow noopener" target="_blank">Make</a>, <a href="https://maven.apache.org/index.html" rel="external nofollow noopener" target="_blank">Maven</a>, and <a href="https://gradle.org/" rel="external nofollow noopener" target="_blank">Gradle</a>. Bazel aims to combine simplicity and power since it uses a human-readable, high-level build language while supporting projects in multiple languages and building outputs for multiple platforms.</p> <p>Some of the highlights of Bazel include:</p> <ul> <li> <strong>Scalability:</strong> allows for building large codebases very quickly using parallel execution, remote caching, and remote execution.</li> <li> <strong>Multi-language support:</strong> engineering teams can standardize a single build tool for many platforms. For exemple, Bazel can be used for iOS and Android applications as well for the server code supporting those apps in whatever language.</li> <li> <strong>Repeatable builds:</strong> release builds can be identical to developer builds. This is particular useful for reproducing issues detected ih the releasead version of any project. It also adds extra safety to the developer workflow.</li> <li> <strong>Extensible:</strong> It can be adopted to new languages and custom tooling. Bazel aims at developers struggling with builds that take too long and/or are too complex to maintain.</li> </ul> <p>Bazel uses <a href="https://github.com/bazelbuild/starlark" rel="external nofollow noopener" target="_blank">Starlark</a>, a language intended for use as a configuration language which was designed for the Bazel build system, but may be also useful for other projects.</p> <p>Starlark’s syntax is inspired by Python3. While its semantics can differ from Python, behavioral differences are supposed to be rare.</p> <p>The rules for most languages are written in Starlark so Bazel is thought of as entire ecosystem of core features and many available rule sets to serve whatever needs a developer might have.</p> <p>The development of Bazel’s core is driven by Google. However, there is a growing community of contributors and service providers working on Bazel’s overall ecosystem.</p> <p>By default, Bazel executes builds and tests in the developer’s local machine. Remote execution allows Bazel to distribute the build and test actions accross multiple machines as a data center. Remote execution provides some benefits. First, faster build and test executions through parallel actions. Also, a consistent execution environment for a development team. Finally, reuse of build outputs accross a development team. So if somebody else already built artifacts required for a developer’s build, that build will be significantly faster. Both execution methods can be combined through dynamic execution. Complex builds that complete earlier remotely while small incremental changes might be more efficient on the developer’s local machine. This is particularly useful for developers working from home.</p> <h1 id="how-bazel-works">How Bazel Works</h1> <p>Bazel is an artifact-based build system. In such a system, engineers config build files. A build file is a declarative manifest that tells the build system what to do (the artifact) and the build system (Bazel) determines how to do it.</p> <p>To illustrate how Bazel works, we will create a toy C++ project. Our project consist of a program that that asks the user for a number. If the user types an integer, the program will compute the factorial of that number. If it types a double, it will compute the <a href="https://en.wikipedia.org/wiki/Gamma_function" rel="external nofollow noopener" target="_blank">Gamma function</a> (an extesion of the factorial function to real and complex numbers).</p> <p>In this example, we want to build three artifacts with Bazel:</p> <ol> <li>An executable binary called compute_factorial</li> <li>A library called factorial</li> <li>And another library called gamma</li> </ol> <p>We will create two directories:</p> <ul> <li>main: for our executable binary</li> <li>lib: for our libraries</li> </ul> <p>In the root of our project, we will create a file called <code class="language-plaintext highlighter-rouge">MODULE.bazel</code> which identifies the directory and its contents as a <strong>Bazel workspace</strong> and lives at the root of the project’s directory structure. It’s also where you specify your external dependencies (when needed). Inside the directories main and lib, we will have a file called <code class="language-plaintext highlighter-rouge">BUILD</code>, which tells Bazel how to build different parts of the project. A directory within the workspace that contains a BUILD file is a <strong>package</strong>.</p> <p>Our project structure will look like the following:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/ (project root)
├── lib
│   ├── BUILD
│   ├── factorial.cc
│   ├── factorial.h
│   ├── gamma.cc
│   └── gamma.h
├── main
│   ├── BUILD
│   └── compute_factorial.cc
└── MODULE.bazel
</code></pre></div></div> <p>Now, we write the code for our project:</p> <p><code class="language-plaintext highlighter-rouge">factorial.h</code>:</p> <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifndef FACTORIAL_H
#define FACTORIAL_H
</span>
<span class="kt">int</span> <span class="nf">factorial</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">);</span>

<span class="cp">#endif
</span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">factorial.cc</code>:</p> <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"factorial.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">factorial</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">factorial</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">gamma.h</code>:</p> <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#ifndef GAMMA_H
#define GAMMA_H
</span>
<span class="kt">double</span> <span class="nf">gamma_function</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">);</span>

<span class="cp">#endif
</span></code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">gamma.cc</code>:</p> <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"gamma.h"</span><span class="cp">
#include</span> <span class="cpf">&lt;cmath&gt;</span><span class="cp">
</span>
<span class="kt">double</span> <span class="nf">gamma_function</span><span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">tgamma</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">compute_factorial.cc</code>:</p> <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
#include</span> <span class="cpf">"../lib/factorial.h"</span><span class="cp">
#include</span> <span class="cpf">"../lib/gamma.h"</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter a number: "</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">number</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">number</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cin</span><span class="p">.</span><span class="n">fail</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"Invalid input. Please enter a valid number.</span><span class="se">\n</span><span class="s">"</span><span class="p">;</span>
        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">number</span> <span class="o">==</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">number</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Factorial of "</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">" is "</span> <span class="o">&lt;&lt;</span> <span class="n">factorial</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">number</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Gamma function of "</span> <span class="o">&lt;&lt;</span> <span class="n">number</span> <span class="o">&lt;&lt;</span> <span class="s">" is "</span> <span class="o">&lt;&lt;</span> <span class="n">gamma_function</span><span class="p">(</span><span class="n">number</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div> <p>All the C++ code we need is created. Now we can focus on building our artifacts.</p> <p>In the file <code class="language-plaintext highlighter-rouge">MODULE.bazel</code>, we will just identify the name of the workspace:</p> <pre><code class="language-bazel">module(name = "factorial_and_gamma")
</code></pre> <p>The <code class="language-plaintext highlighter-rouge">BUILD</code> for the <code class="language-plaintext highlighter-rouge">lib</code> package will contain the following:</p> <pre><code class="language-bazel">cc_library(
    name = "factorial",
    srcs = ["factorial.cc"],
    hdrs = ["factorial.h"],
    visibility = ["//main:__pkg__"],
)

cc_library(
    name = "gamma",
    srcs = ["gamma.cc"],
    hdrs = ["gamma.h"],
    visibility = ["//main:__pkg__"],
)
</code></pre> <p>The rule <a href="https://bazel.build/reference/be/c-cpp#cc_library" rel="external nofollow noopener" target="_blank">cc_library</a> is used for for C++-compiled libraries. The result is either a <code class="language-plaintext highlighter-rouge">.so</code>, <code class="language-plaintext highlighter-rouge">.lo</code>, or <code class="language-plaintext highlighter-rouge">.a</code>, depending on what is needed. Bazel’s documentation emphasizes that all header files that are used in the build must be declared in the <code class="language-plaintext highlighter-rouge">hdrs</code> or <code class="language-plaintext highlighter-rouge">srcs</code> of <code class="language-plaintext highlighter-rouge">cc_*</code> rules, which is enforced.</p> <p>The attributes <code class="language-plaintext highlighter-rouge">name</code>, <code class="language-plaintext highlighter-rouge">srcs</code>, and <code class="language-plaintext highlighter-rouge">hdrs</code>, as the names suggest, are for specifying the name, the source files, and the headers for each library. The attribute <code class="language-plaintext highlighter-rouge">visibility</code> determines what has access to the library. In our case, only the package <code class="language-plaintext highlighter-rouge">main</code> has access to the libraries <code class="language-plaintext highlighter-rouge">factorial</code> and <code class="language-plaintext highlighter-rouge">gamma</code>. If <code class="language-plaintext highlighter-rouge">main</code> had subpackages, those would not have access to the libraries. Read <a href="https://bazel.build/concepts/visibility" rel="external nofollow noopener" target="_blank">Bazel’s documentation on visibility</a> for more information on other types of access.</p> <p>The <code class="language-plaintext highlighter-rouge">BUILD</code> for the <code class="language-plaintext highlighter-rouge">main</code> package will contain the following:</p> <pre><code class="language-bazel">cc_binary(
    name = "compute_factorial",
    srcs = ["compute_factorial.cc"],
    deps = [
        "//lib:factorial",
        "//lib:gamma",
    ],
)
</code></pre> <p>The rule <a href="https://bazel.build/reference/be/c-cpp#cc_binary" rel="external nofollow noopener" target="_blank">cc_binary</a>, as the name implies, produces an executable binary. Here we are defining the name, the source files, and the dependecies for building the executable binary.</p> <p>This is all we need to build our project.</p> <h2 id="building">Building</h2> <p>We will now use Bazel to build the <code class="language-plaintext highlighter-rouge">main</code> package with the target name<code class="language-plaintext highlighter-rouge">compute_factorial</code>:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel build //main:compute_factorial
</code></pre></div></div> <p>Bazel will produce something like:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO: Analyzed target //main:compute_factorial <span class="o">(</span>88 packages loaded, 451 targets configured<span class="o">)</span><span class="nb">.</span>
INFO: Found 1 target...
Target //main:compute_factorial up-to-date:
  bazel-bin/main/compute_factorial
INFO: Elapsed <span class="nb">time</span>: 0.861s, Critical Path: 0.38s
INFO: 18 processes: 12 internal, 6 darwin-sandbox.
INFO: Build completed successfully, 18 total actions
</code></pre></div></div> <p>Now, we run our executable binary as follows:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel-bin/main/compute_factorial
</code></pre></div></div> <p>Which will present the following:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Enter a number:
</code></pre></div></div> <p>We will type <code class="language-plaintext highlighter-rouge">5</code>, which will result in the following:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Enter a number: 5
Factorial of 5 is 120
</code></pre></div></div> <p>If we run the program again and type <code class="language-plaintext highlighter-rouge">5.5</code>, we will see the following result:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Enter a number: 5.5
Gamma <span class="k">function </span>of 5.5 is 287.885
</code></pre></div></div> <p>To clean up after Bazel generate the build-related files, we run:</p> <pre><code class="language-bazel">bazel clean
</code></pre> <h2 id="dependency-graph">Dependency Graph</h2> <p>In our project, we have a binary target called <code class="language-plaintext highlighter-rouge">compute_factorial</code> in the <code class="language-plaintext highlighter-rouge">main</code> package that depends on two libraries: <code class="language-plaintext highlighter-rouge">factorial</code> and <code class="language-plaintext highlighter-rouge">gamma</code>, both of which are in the <code class="language-plaintext highlighter-rouge">lib</code> package:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>                      //main:compute_factorial
                             |
            ----------------------------------------
            |                                      |
      //lib:factorial                         //lib:gamma
            |                                      |
  --------------------                ---------------------
  |                  |                |                   |
lib/factorial.cc  lib/factorial.h   lib/gamma.cc      lib/gamma.h
</code></pre></div></div> <h2 id="testing">Testing</h2> <p>We will add testing to our project with <a href="https://github.com/google/googletest" rel="external nofollow noopener" target="_blank">Google Test</a>.</p> <p>The first step to add Google Test is to modify our <code class="language-plaintext highlighter-rouge">MODULE.bazel</code>, which has several methods available to use. One of them is <code class="language-plaintext highlighter-rouge">bazel_dep</code> for declaring a direct dependency on another Bazel module.</p> <p>Our <code class="language-plaintext highlighter-rouge">MODULE.bazel</code> will be updated to:</p> <pre><code class="language-bazel">module(name = "factorial_and_gamma")

bazel_dep(name = "googletest", version = "1.15.2")
</code></pre> <p>Next, we create a new package called <code class="language-plaintext highlighter-rouge">test</code> andd we add two test files, one for each library.</p> <p><code class="language-plaintext highlighter-rouge">factorial_test.cc</code>:</p> <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"gtest/gtest.h"</span><span class="cp">
#include</span> <span class="cpf">"lib/factorial.h"</span><span class="cp">
</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">FactorialTest</span><span class="p">,</span> <span class="n">ComputesCorrectly</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">EXPECT_EQ</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="mi">120</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">gamma_test.h</code>:</p> <div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include</span> <span class="cpf">"gtest/gtest.h"</span><span class="cp">
#include</span> <span class="cpf">"lib/gamma.h"</span><span class="cp">
</span>
<span class="n">TEST</span><span class="p">(</span><span class="n">GammaTest</span><span class="p">,</span> <span class="n">ComputesCorrectly</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">EXPECT_NEAR</span><span class="p">(</span><span class="n">gamma_function</span><span class="p">(</span><span class="mf">5.5</span><span class="p">),</span> <span class="mf">287.885</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div> <p>We also add a <code class="language-plaintext highlighter-rouge">BUILD</code> file to the test package where we define the name, source files and dependencies for our tests:</p> <pre><code class="language-bazel">cc_test(
    name = "factorial_test",
    srcs = ["factorial_test.cc"],
    deps = [
        "@googletest//:gtest_main",
        "//lib:factorial",
    ],
)

cc_test(
    name = "gamma_test",
    srcs = ["gamma_test.cc"],
    deps = [
        "@googletest//:gtest_main",
        "//lib:gamma",
    ],
)
</code></pre> <p>Our new project structure looks like the following:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/ (root)
├── lib
│   ├── BUILD
│   ├── factorial.cc
│   ├── factorial.h
│   ├── gamma.cc
│   └── gamma.h
├── main
│   ├── BUILD
│   └── compute_factorial.cc
├── test
│   ├── BUILD
│   ├── factorial_test.cc
│   └── gamma_test.cc
└── MODULE.bazel
</code></pre></div></div> <p>Before building the project again, we can either run:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel clean
</code></pre></div></div> <p>which removes the output directories created by Bazel, or</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel clean <span class="nt">--expunge</span>
</code></pre></div></div> <p>When we add <code class="language-plaintext highlighter-rouge">--expunge</code>, in addition to remove the output directories, all all cached build data, intermediate files, action logs, and Bazel’s local cache (where Bazel stores information that speeds up incremental builds) will be also removed. In other words, <code class="language-plaintext highlighter-rouge">bazel clean --expunge</code> performs a full reset of the Bazel environment.</p> <p>We can now build the project again:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel build //main:compute_factorial
</code></pre></div></div> <p>and run the tests:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel <span class="nb">test</span> //test:factorial_test
</code></pre></div></div> <p>Which produces something like:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO: Analyzed target //test:factorial_test <span class="o">(</span>3 packages loaded, 87 targets configured<span class="o">)</span><span class="nb">.</span>
INFO: Found 1 <span class="nb">test </span>target...
Target //test:factorial_test up-to-date:
  bazel-bin/test/factorial_test
INFO: Elapsed <span class="nb">time</span>: 1.468s, Critical Path: 1.38s
INFO: 30 processes: 10 internal, 20 darwin-sandbox.
INFO: Build completed successfully, 30 total actions
//test:factorial_test                                                    PASSED <span class="k">in </span>0.2s

Executed 1 out of 1 <span class="nb">test</span>: 1 <span class="nb">test </span>passes.
</code></pre></div></div> <p>and run</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel <span class="nb">test</span> //test:gamma_test
</code></pre></div></div> <p>which produces something like:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>INFO: Analyzed target //test:gamma_test <span class="o">(</span>0 packages loaded, 2 targets configured<span class="o">)</span><span class="nb">.</span>
INFO: Found 1 <span class="nb">test </span>target...
Target //test:gamma_test up-to-date:
  bazel-bin/test/gamma_test
INFO: Elapsed <span class="nb">time</span>: 0.638s, Critical Path: 0.57s
INFO: 9 processes: 6 internal, 3 darwin-sandbox.
INFO: Build completed successfully, 9 total actions
//test:gamma_test                                                        PASSED <span class="k">in </span>0.2s

Executed 1 out of 1 <span class="nb">test</span>: 1 <span class="nb">test </span>passes.
</code></pre></div></div> <p>To run all tests we have the command:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bazel <span class="nb">test</span> //...
</code></pre></div></div> <p>where <code class="language-plaintext highlighter-rouge">//...</code> is a wildcard that tells Bazel to run all test targets in the entire workspace, regardless of where they are located.</p> <h1 id="code">Code</h1> <p>You can get the <a href="https://github.com/davidwilliam/bazel_sample_project" rel="external nofollow noopener" target="_blank">code for the example</a> discussed in this post on GitHub.</p> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/the-balanced-brackets-problem/">The Balanced Brackets Problem - The Ruby Way</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/breaking-the-chain/">Breaking the Chain - The Unspoken Truth About Bad Attitudes in the Workplace and How to Eradicate Them for Good</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2022/metaprogramming-ruby/">Metaprogramming in Ruby</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 David W. Silva. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?601a2d3465e2a52bec38b600518d5f70"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-computer-science",title:"Computer Science",description:"",section:"Navigation",handler:()=>{window.location.href="/computer_science/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-publications",title:"publications",description:"publications by categories in reversed chronological order.",section:"Navigation",handler:()=>{window.location.href="/publications/"}},{id:"nav-projects",title:"projects",description:"A growing collection of your cool projects.",section:"Navigation",handler:()=>{window.location.href="/projects/"}},{id:"nav-repositories",title:"repositories",description:"Current and old coding projects.",section:"Navigation",handler:()=>{window.location.href="/repositories/"}},{id:"dropdown-publications",title:"publications",description:"",section:"Dropdown",handler:()=>{window.location.href=""}},{id:"dropdown-projects",title:"projects",description:"",section:"Dropdown",handler:()=>{window.location.href=""}},{id:"dropdown-blog",title:"blog",description:"",section:"Dropdown",handler:()=>{window.location.href="/blog/"}},{id:"post-bulding-and-testing-a-c-project-with-bazel",title:"Bulding and Testing a C++ Project with Bazel",description:"Bulding and testing a C++ project with Bazel",section:"Posts",handler:()=>{window.location.href="/blog/2024/building-with-bazel/"}},{id:"post-the-balanced-brackets-problem-the-ruby-way",title:"The Balanced Brackets Problem - The Ruby Way",description:"The balanced brackets problem is a well-known problem in computer science and programming in general. It asks if a string of brackets is balanced and therefore valid, which means that the brackets are in the correct order and there are no unmatched brackets. Whovever works with Ruby for programming, will try to solve any problem in &quot;the Ruby way&quot;, that is, with simplicity, elegance, and human-centered design. The Ruby Way can be described as a philosophy that encourages programmers to write code that is both powerful and easy to understand.",section:"Posts",handler:()=>{window.location.href="/blog/2024/the-balanced-brackets-problem/"}},{id:"post-breaking-the-chain-the-unspoken-truth-about-bad-attitudes-in-the-workplace-and-how-to-eradicate-them-for-good",title:"Breaking the Chain - The Unspoken Truth About Bad Attitudes in the Workplace...",description:"Bad attitudes in the workspace are like a baby monster that, when fed, grows strong and eats the owner and everyone around. It is a culture destroyer, a team demolisher, a dream invalidator, a motivation crusher, a corrupter of good practices, and a productivity suppressor. In this article, I write about the unspoken truth about bad attitudes and how to respond to it.",section:"Posts",handler:()=>{window.location.href="/blog/2024/breaking-the-chain/"}},{id:"post-metaprogramming-in-ruby",title:"Metaprogramming in Ruby",description:"Manipulating language constructs at runtime",section:"Posts",handler:()=>{window.location.href="/blog/2022/metaprogramming-ruby/"}},{id:"computer_science-algorithms-and-data-structures",title:"Algorithms and Data Structures",description:"",section:"Computer_science",handler:()=>{window.location.href="/computer_science/cs_0/"}},{id:"computer_science-bubble-sort",title:"Bubble Sort",description:"",section:"Computer_science",handler:()=>{window.location.href="/computer_science/cs_1/"}},{id:"computer_science-selection-sort",title:"Selection Sort",description:"",section:"Computer_science",handler:()=>{window.location.href="/computer_science/cs_2/"}},{id:"computer_science-insertion-sort",title:"Insertion Sort",description:"",section:"Computer_science",handler:()=>{window.location.href="/computer_science/cs_3/"}},{id:"computer_science-quick-sort",title:"Quick Sort",description:"",section:"Computer_science",handler:()=>{window.location.href="/computer_science/cs_4/"}},{id:"news-uk-ico-releases-privacy-notice-generator-for-smes",title:"UK ICO releases Privacy Notice Generator for SMEs",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_4/"}},{id:"news-when-will-ai-s-rewards-surpass-its-risks",title:"When Will AI\u2019s Rewards Surpass Its Risks?",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_3/"}},{id:"news-significant-ransom-payment-by-major-iranian-it-firm-underway",title:"Significant ransom payment by major Iranian IT firm underway",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_2/"}},{id:"projects-gdpr-part-2",title:"GDPR Part 2",description:"Terminology and Basic Definitions",section:"Projects",handler:()=>{window.location.href="/projects/10_project/"}},{id:"projects-our-mission-in-iceland",title:"Our Mission in Iceland",description:"March 15 - April 1, 2022",section:"Projects",handler:()=>{window.location.href="/projects/11_project/"}},{id:"projects-gdpr-part-3",title:"GDPR Part 3",description:"Terminology and Basic Definitions",section:"Projects",handler:()=>{window.location.href="/projects/12_project/"}},{id:"projects-gdpr-part-4",title:"GDPR Part 4",description:"Identification, Classification, and Analysis",section:"Projects",handler:()=>{window.location.href="/projects/13_project/"}},{id:"projects-the-teleological-view-of-the-benefit",title:"The Teleological View of the Benefit",description:"How to use a clear view of the future to drive your efforts in the present",section:"Projects",handler:()=>{window.location.href="/projects/15_project/"}},{id:"projects-generative-ai-a-great-assistant-terrible-teacher",title:"Generative AI - A Great Assistant, Terrible Teacher",description:"With great generative power comes plenty of risks.",section:"Projects",handler:()=>{window.location.href="/projects/18_project/"}},{id:"projects-the-ubiquitous-nature-of-modern-business-intelligence",title:"The Ubiquitous Nature Of Modern Business Intelligence",description:"Data is everyhere, so it is BI",section:"Projects",handler:()=>{window.location.href="/projects/19_project/"}},{id:"projects-ai-analytics-in-manufacturing-top-strategies-from-tech-experts",title:"AI Analytics In Manufacturing - Top Strategies From Tech Experts",description:"AI in manufacturing is a promising application.",section:"Projects",handler:()=>{window.location.href="/projects/20_project/"}},{id:"projects-using-genai-for-coding-how-to-leverage-it-wisely-and-well",title:"Using GenAI For Coding? How To Leverage It Wisely And Well",description:"It&#39;s important to treat generative AI as a tool, not a full-fledged teammate.",section:"Projects",handler:()=>{window.location.href="/projects/21_project/"}},{id:"projects-the-richness-of-communication-and-the-challenges-in-the-post-covid-era",title:"The Richness of Communication and the Challenges in the Post-COVID Era",description:"Are we efficiently communicating in this new remote world?",section:"Projects",handler:()=>{window.location.href="/projects/3_project/"}},{id:"projects-what-is-trust",title:"What is Trust?",description:"What it means to trust something or someone?",section:"Projects",handler:()=>{window.location.href="/projects/4_project/"}},{id:"projects-your-weak-password-can-be-cracked-in-a-few-seconds",title:"Your Weak Password Can Be Cracked In A Few Seconds",description:"If you have to use passwords, do it the right way",section:"Projects",handler:()=>{window.location.href="/projects/5_project/"}},{id:"projects-passwords-and-human-convenience-a-match-made-in-hell",title:"Passwords and Human Convenience - A Match Made in Hell",description:"Convenience can get you in trouble",section:"Projects",handler:()=>{window.location.href="/projects/6_project/"}},{id:"projects-the-addiction-of-procrastination",title:"The Addiction of Procrastination",description:"A vice that must be overcome",section:"Projects",handler:()=>{window.location.href="/projects/7_project/"}},{id:"projects-why-startups-fail",title:"Why Startups Fail",description:"The science behind startup failure and success",section:"Projects",handler:()=>{window.location.href="/projects/8_project/"}},{id:"projects-gdpr-part-1",title:"GDPR Part 1",description:"Context, Motivations, and Goals",section:"Projects",handler:()=>{window.location.href="/projects/9_project/"}},{id:"socials-email",title:"Send email",section:"Socials",handler:()=>{window.open("mailto:%63%6F%6E%74%61%63%74@%64%61%76%69%64%77%73%69%6C%76%61.%63%6F%6D","_blank")}},{id:"socials-orcid",title:"ORCID",section:"Socials",handler:()=>{window.open("https://orcid.org/0000-0003-4498-0525","_blank")}},{id:"socials-google-scholar",title:"Google Scholar",section:"Socials",handler:()=>{window.open("https://scholar.google.com/citations?user=7sQnBGcAAAAJ","_blank")}},{id:"socials-researchgate",title:"ResearchGate",section:"Socials",handler:()=>{window.open("https://www.researchgate.net/profile/David-W-H-A-Da-Silva-2/","_blank")}},{id:"socials-linkedin",title:"LinkedIn",section:"Socials",handler:()=>{window.open("https://www.linkedin.com/in/davidwilliamsilva","_blank")}},{id:"socials-x",title:"X",description:"Twitter",section:"Socials",handler:()=>{window.open("https://twitter.com/davidwsilva_","_blank")}},{id:"socials-instagram",title:"Instagram",section:"Socials",handler:()=>{window.open("https://instagram.com/davidwsilva_","_blank")}},{id:"socials-rss",title:"RSS Feed",section:"Socials",handler:()=>{window.open("/feed.xml","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>